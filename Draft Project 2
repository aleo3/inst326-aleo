from collections import defaultdict

class SearchEngine:
    def __init__(self, records):
        """
        Initialize the search engine with a list of records (dictionaries).
        """
        if not isinstance(records, list):
            raise ValueError("Records should be a list of dictionaries.")
        self.records = records

    def calculate_relevance_scores(self, query, fields_weights):
        """
        Calculate relevance scores for records based on a query.
        Args:
            query (str): The search query.
            fields_weights (dict): Dictionary mapping field names to weights.
        Returns:
            List of relevance scores corresponding to each record.
        """
        query_terms = query.lower().split()
        scores = []

        for record in self.records:
            score = 0
            for field, weight in fields_weights.items():
                text = record.get(field, "").lower()
                if not text:
                    continue
                field_terms = text.split()
                term_freq = {term: field_terms.count(term) / len(field_terms) for term in set(field_terms)}
                for qt in query_terms:
                    score += term_freq.get(qt, 0) * weight
            scores.append(score)
        return scores

    def format_search_results(self, results):
        """
        Format a list of search result dictionaries into a readable string.
        Args:
            results (list): List of result dictionaries.
        Returns:
            str: Formatted string of top 10 search results.
        """
        if not results or not isinstance(results, list):
            return "No valid search results found."

        formatted = []
        for i, result in enumerate(results[:10], 1):  # Limit to top 10
            title = result.get("title", "No Title")
            snippet = result.get("snippet", "No description available.")
            formatted.append(f"{i}. {title}\n   {snippet}\n")    
        return "\n".join(formatted)
